<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>CImg.display: CImg.display.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>CImg.display.cpp</h1><a href="CImg_8display_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*-----------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  File        : display.cpp</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  Description : display of image program of the Laboratory of Mechanics in Lille (LML)</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">  Author      : Sebastien COUDERT</span>
<a name="l00008"></a>00008 <span class="comment">  </span>
<a name="l00009"></a>00009 <span class="comment">  --------------------------------------------------------------------*/</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="comment">/*Additional documentation for the generation of the reference page (using doxygen)*/</span>
<a name="l00159"></a>00159 <span class="comment">// Include CImg library file and use its main namespace</span>
<a name="l00160"></a>00160 <span class="preprocessor">#include "CImg.h"</span>
<a name="l00161"></a>00161 <span class="keyword">using namespace </span>cimg_library;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00164"></a>00164 <span class="comment">//debug macro</span>
<a name="l00165"></a>00165 <span class="preprocessor">#if cimg_verbosity&gt;=3</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span><span class="preprocessor">#define PR(value) std::cerr&lt;&lt;#value&lt;&lt;"="&lt;&lt;value&lt;&lt;std::endl&lt;&lt;std::flush;</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00168"></a><a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define PR(value) ;</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00172"></a>00172 
<a name="l00175"></a>00175 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00176"></a><a class="code" href="CImg_8display_8cpp.html#1ddf6ad29b94342df84bf770d6d90b11">00176</a> <span class="keywordtype">void</span> <a class="code" href="CImg_8display_8cpp.html#1ddf6ad29b94342df84bf770d6d90b11" title="display image as both 2D map and 1D graphs along x or y axis">display1D2D</a>(CImg&lt;T&gt; image)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178   <span class="comment">//convert image to RGB</span>
<a name="l00179"></a>00179   image.resize(-100,-100,1,3);
<a name="l00180"></a>00180   <span class="comment">// Create two display window, one for the image, the other for the color profile.</span>
<a name="l00181"></a>00181   CImgDisplay
<a name="l00182"></a>00182     main_disp(image,<span class="stringliteral">"Color image (Click on mouse buttons: left and right)"</span>,0),
<a name="l00183"></a>00183     draw_disp(image.width(),512,<span class="stringliteral">"Color profile along X or Y axis"</span>,0);
<a name="l00184"></a>00184   <span class="keywordtype">bool</span> refresh_draw=<span class="keyword">true</span>;
<a name="l00185"></a>00185   <span class="comment">// button, X and Y-coordinate of the mouse pointer over the image</span>
<a name="l00186"></a>00186   <span class="keywordtype">int</span> bm,xm,ym;bm=xm=ym=0;
<a name="l00187"></a>00187   <span class="comment">// Define colors used to plot the profile, and a hatch to draw the vertical line</span>
<a name="l00188"></a>00188   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hatch = 0xF0F0F0F0;
<a name="l00189"></a>00189   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l00190"></a>00190             <span class="comment">// R   G   B</span>
<a name="l00191"></a>00191     red[]   = {255,  0,  0},
<a name="l00192"></a>00192     green[] = {  0,255,  0},
<a name="l00193"></a>00193     blue [] = {  0,  0,255},
<a name="l00194"></a>00194     black[] = {  0,  0,  0},
<a name="l00195"></a>00195     white[] = {255,255,255};
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="comment">//display and post process image as color or grey scale</span>
<a name="l00198"></a>00198   CImg&lt;unsigned char&gt; image_pp(image);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="comment">//event loop</span>
<a name="l00201"></a>00201   <span class="comment">//This loop ends when one of the two display window is closed or when the keys 'ESC' or 'Q' are pressed.</span>
<a name="l00202"></a>00202   <span class="keywordflow">while</span>(!main_disp.is_closed() &amp;&amp; !draw_disp.is_closed() &amp;&amp;
<a name="l00203"></a>00203         !main_disp.is_keyESC() &amp;&amp; !draw_disp.is_keyESC() &amp;&amp; !main_disp.is_keyQ() &amp;&amp; !draw_disp.is_keyQ())
<a name="l00204"></a>00204   {
<a name="l00205"></a>00205     <span class="comment">// Handle display window resizing (if any)</span>
<a name="l00206"></a>00206     <span class="keywordflow">if</span> (main_disp.is_resized()) main_disp.resize().display(image);
<a name="l00207"></a>00207     draw_disp.resize();
<a name="l00208"></a>00208     <span class="comment">//key board</span>
<a name="l00209"></a>00209     <span class="keywordflow">if</span>(main_disp.is_keyC()||main_disp.is_keyV()||main_disp.is_keyL()||main_disp.is_keyI())
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211 <a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(main_disp.key());
<a name="l00212"></a>00212       <span class="comment">//post process image (color or grey scale)</span>
<a name="l00213"></a>00213       <span class="keywordflow">switch</span>(main_disp.key())
<a name="l00214"></a>00214       {
<a name="l00215"></a>00215         <span class="comment">//RGB color</span>
<a name="l00216"></a>00216         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
<a name="l00217"></a>00217         {
<a name="l00218"></a>00218           main_disp.set_title(<span class="stringliteral">"Color image (Click on mouse buttons: left and right)"</span>);
<a name="l00219"></a>00219           std::cout&lt;&lt;<span class="stringliteral">"\rswitch to color image.                        "</span>&lt;&lt;std::flush;
<a name="l00220"></a>00220           image_pp=image;
<a name="l00221"></a>00221         } <span class="keywordflow">break</span>;
<a name="l00222"></a>00222         <span class="comment">//convert to grey level</span>
<a name="l00223"></a>00223         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
<a name="l00224"></a>00224         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
<a name="l00225"></a>00225         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227           CImg&lt;unsigned char&gt; grey_level;
<a name="l00228"></a>00228           main_disp.set_title(<span class="stringliteral">"Grey level image (Click on mouse buttons: left and right)"</span>);
<a name="l00229"></a>00229           std::cout&lt;&lt;<span class="stringliteral">"\rswitch to grey level image based on "</span>;
<a name="l00230"></a>00230           <span class="keywordflow">switch</span>(main_disp.key())
<a name="l00231"></a>00231           {
<a name="l00232"></a>00232             <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: std::cout&lt;&lt;<span class="stringliteral">"value.    "</span>;grey_level=image.get_RGBtoHSV().get_channel(2)*255; <span class="keywordflow">break</span>;
<a name="l00233"></a>00233             <span class="keywordflow">case</span> <span class="charliteral">'l'</span>: std::cout&lt;&lt;<span class="stringliteral">"lightness."</span>;grey_level=image.get_RGBtoHSL().get_channel(2)*255; <span class="keywordflow">break</span>;
<a name="l00234"></a>00234             <span class="keywordflow">case</span> <span class="charliteral">'i'</span>: std::cout&lt;&lt;<span class="stringliteral">"intensity."</span>;grey_level=image.get_RGBtoHSI().get_channel(2)*255; <span class="keywordflow">break</span>;
<a name="l00235"></a>00235           }<span class="comment">//switch grey</span>
<a name="l00236"></a>00236           std::cout&lt;&lt;std::flush;
<a name="l00237"></a>00237           cimg_forC(image_pp,c) image_pp.get_shared_channel(c)=grey_level;
<a name="l00238"></a>00238         } <span class="keywordflow">break</span>;
<a name="l00239"></a>00239       }<span class="comment">//switch color or grey</span>
<a name="l00240"></a>00240       <span class="comment">//display new image</span>
<a name="l00241"></a>00241       image_pp.display(main_disp);
<a name="l00242"></a>00242       <span class="comment">//reset key buffer</span>
<a name="l00243"></a>00243       main_disp.set_key();
<a name="l00244"></a>00244       refresh_draw=<span class="keyword">true</span>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246     <span class="comment">//mouse button</span>
<a name="l00247"></a>00247     <span class="keywordflow">if</span>(main_disp.button()!=0)
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249 <a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(main_disp.button());
<a name="l00250"></a>00250 <a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(main_disp.mouse_x());<a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(main_disp.mouse_y());
<a name="l00251"></a>00251       <span class="keywordflow">if</span>(main_disp.mouse_x()&gt;=0 &amp;&amp; main_disp.mouse_y()&gt;=0)
<a name="l00252"></a>00252       {<span class="comment">// Mouse pointer is over the image</span>
<a name="l00253"></a>00253         bm=main_disp.button(); <span class="comment">// button of the mouse over the image</span>
<a name="l00254"></a>00254         xm=main_disp.mouse_x();<span class="comment">// X-coordinate of the mouse pointer over the image</span>
<a name="l00255"></a>00255         ym=main_disp.mouse_y();<span class="comment">// Y-coordinate of the mouse pointer over the image</span>
<a name="l00256"></a>00256         refresh_draw=<span class="keyword">true</span>;
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258       <span class="keywordflow">else</span>
<a name="l00259"></a>00259       {
<a name="l00260"></a>00260         <span class="comment">// else display a text in the profile display window.</span>
<a name="l00261"></a>00261         CImg&lt;unsigned char&gt;(draw_disp.width(),draw_disp.height()).fill(255).
<a name="l00262"></a>00262           draw_text(draw_disp.width()/2-110,draw_disp.height()/2-5,<span class="stringliteral">"Mouse pointer is outside the image"</span>,black).
<a name="l00263"></a>00263           display(draw_disp);
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266     <span class="comment">//draw graphs in draw display</span>
<a name="l00267"></a>00267     <span class="keywordflow">if</span>(refresh_draw)
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269 <a class="code" href="CImg_8display_8cpp.html#ea1ac050c1347d4a67f85cbfc88ec8cf">PR</a>(refresh_draw);
<a name="l00270"></a>00270       <span class="keyword">const</span> <span class="keywordtype">int</span>
<a name="l00271"></a>00271         xl=xm*draw_disp.width()/main_disp.width(),<span class="comment">// Corresponding X-coordinate of the hatched line</span>
<a name="l00272"></a>00272         x =xm*image.width()/main_disp.width(),    <span class="comment">// Corresponding X-coordinate of the pointed pixel in the image</span>
<a name="l00273"></a>00273         y =ym*image.height()/main_disp.height();  <span class="comment">// Corresponding Y-coordinate of the pointex pixel in the image</span>
<a name="l00274"></a>00274 
<a name="l00275"></a>00275       <span class="comment">// Retrieve color component values at pixel (x,y)</span>
<a name="l00276"></a>00276       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00277"></a>00277         val_red   = image_pp(x,y,0),
<a name="l00278"></a>00278         val_green = image_pp(x,y,1),
<a name="l00279"></a>00279         val_blue  = image_pp(x,y,2);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281       <span class="keywordflow">if</span>(bm==1)
<a name="l00282"></a>00282       {
<a name="l00283"></a>00283         <span class="comment">//display actual line on main display</span>
<a name="l00284"></a>00284         CImg&lt;unsigned char&gt;(image_pp).
<a name="l00285"></a>00285           draw_line(0,ym,main_disp.width()-1,ym,white,0.5f,hatch=cimg::rol(hatch)).
<a name="l00286"></a>00286           display(main_disp);
<a name="l00287"></a>00287         <span class="comment">//Create and display the graph of the intensity profile</span>
<a name="l00288"></a>00288         <span class="keywordtype">int</span> width=image.width(),height=draw_disp.height();
<a name="l00289"></a>00289         draw_disp.set_title(<span class="stringliteral">"Color profile along X axis"</span>).resize(width,height,<span class="keyword">true</span>);
<a name="l00290"></a>00290         CImg&lt;unsigned char&gt;(width,height,1,3,255).
<a name="l00291"></a>00291           draw_grid(-50*100.0f/width,-50*100.0f/256,0,0,<span class="keyword">false</span>,<span class="keyword">true</span>,black,0.2f,0xCCCCCCCC,0xCCCCCCCC).
<a name="l00292"></a>00292           draw_axes(0,image.width()-1.0f,255.0f,0.0f,black).
<a name="l00293"></a>00293           draw_graph(image_pp.get_shared_line(y,0,0),red,1,1,0,255,1).
<a name="l00294"></a>00294           draw_graph(image_pp.get_shared_line(y,0,1),green,1,1,0,255,1).
<a name="l00295"></a>00295           draw_graph(image_pp.get_shared_line(y,0,2),blue,1,1,0,255,1).
<a name="l00296"></a>00296           draw_text(30,5,<span class="stringliteral">"Pixel (%d,%d)={%d %d %d}"</span>,black,0,1,13,xm,ym,val_red,val_green,val_blue).
<a name="l00297"></a>00297           draw_line(xl,0,xl,draw_disp.height()-1,black,0.5f,hatch=cimg::rol(hatch)).
<a name="l00298"></a>00298           display(draw_disp);
<a name="l00299"></a>00299       }<span class="comment">//bm==1</span>
<a name="l00300"></a>00300       <span class="keywordflow">if</span>(bm==2)
<a name="l00301"></a>00301       {
<a name="l00302"></a>00302         <span class="comment">//display actual line on main display</span>
<a name="l00303"></a>00303         CImg&lt;unsigned char&gt;(image_pp).
<a name="l00304"></a>00304           draw_line(xm,0,xm,main_disp.height()-1,white,0.5f,hatch=cimg::rol(hatch)).
<a name="l00305"></a>00305           display(main_disp);
<a name="l00306"></a>00306         <span class="comment">//Create and display the graph of the intensity profile</span>
<a name="l00307"></a>00307         <span class="keywordtype">int</span> width=image.height(),height=draw_disp.height();
<a name="l00308"></a>00308         draw_disp.set_title(<span class="stringliteral">"Color profile along Y axis"</span>).resize(width,height,<span class="keyword">true</span>);
<a name="l00309"></a>00309         CImg&lt;unsigned char&gt;(width,height,1,3,255).
<a name="l00310"></a>00310           draw_grid(-50*100.0f/width,-50*100.0f/256,0,0,<span class="keyword">false</span>,<span class="keyword">true</span>,black,0.2f,0xCCCCCCCC,0xCCCCCCCC).
<a name="l00311"></a>00311           draw_axes(0,image.height()-1.0f,255.0f,0.0f,black).
<a name="l00312"></a>00312           draw_graph(image_pp.get_crop(x,0,0,0,x,image.height()-1,0,0),red,1,1,0,255,1).<span class="comment">//red graph</span>
<a name="l00313"></a>00313           draw_graph(image_pp.get_crop(x,0,0,1,x,image.height()-1,0,1),green,1,1,0,255,1).<span class="comment">//green graph</span>
<a name="l00314"></a>00314           draw_graph(image_pp.get_crop(x,0,0,2,x,image.height()-1,0,2),blue,1,1,0,255,1).<span class="comment">//blue graph</span>
<a name="l00315"></a>00315           draw_text(30,5,<span class="stringliteral">"Pixel (%d,%d)={%d %d %d}"</span>,black,0,1,13,xm,ym,val_red,val_green,val_blue).<span class="comment">//actual position and RGB as text</span>
<a name="l00316"></a>00316           draw_line(xl,0,xl,draw_disp.height()-1,black,0.5f,hatch=cimg::rol(hatch)).
<a name="l00317"></a>00317           display(draw_disp);
<a name="l00318"></a>00318       }<span class="comment">//bm==2</span>
<a name="l00319"></a>00319       refresh_draw=<span class="keyword">false</span>;
<a name="l00320"></a>00320     }<span class="comment">//draw window</span>
<a name="l00321"></a>00321     <span class="comment">// Temporize event loop</span>
<a name="l00322"></a>00322     cimg::wait(20);
<a name="l00323"></a>00323   }<span class="comment">//event loop</span>
<a name="l00324"></a>00324 }
<a name="l00326"></a>00326 
<a name="l00329"></a>00329 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00330"></a><a class="code" href="CImg_8display_8cpp.html#b599c0258589192cac899b35ef432ce0">00330</a> <span class="keywordtype">void</span> <a class="code" href="CImg_8display_8cpp.html#b599c0258589192cac899b35ef432ce0" title="display image as 3D surface">display3D</a>(CImg&lt;T&gt; image,
<a name="l00331"></a>00331   <span class="keyword">const</span> <span class="keywordtype">char</span> *file_o,<span class="keyword">const</span> <span class="keywordtype">float</span> ratioz,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di,
<a name="l00332"></a>00332   <span class="keyword">const</span> <span class="keywordtype">char</span> *file_pose_i,<span class="keyword">const</span> <span class="keywordtype">char</span> *file_pose_o,
<a name="l00333"></a>00333   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtype,<span class="keywordtype">bool</span> color_type)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335   std::cout&lt;&lt;<span class="stringliteral">"display image as 3D surface"</span>&lt;&lt;std::flush;
<a name="l00336"></a>00336   <span class="keyword">const</span> CImg&lt;unsigned char&gt; norm=image.get_norm().normalize(0,255);
<a name="l00337"></a>00337   <span class="comment">// Compute surface with triangles.</span>
<a name="l00338"></a>00338   std::fprintf(stderr,<span class="stringliteral">"\n- Create image surface"</span>); std::fflush(stderr);
<a name="l00339"></a>00339   CImgList&lt;unsigned int&gt; primitives;
<a name="l00341"></a>00341   CImgList&lt;unsigned char&gt; colors;
<a name="l00342"></a>00342   <span class="keyword">const</span> CImg&lt;&gt; points = image.get_elevation3d(primitives,colors,norm*-ratioz);
<a name="l00344"></a>00344   CImgList&lt;unsigned char&gt; colors2;
<a name="l00345"></a>00345   colors2=colors;
<a name="l00346"></a>00346   cimglist_for(colors2,l) colors2(l).fill(255);<span class="comment">//white</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="comment">// Compute image isophotes.</span>
<a name="l00349"></a>00349   std::fprintf(stderr,<span class="stringliteral">"\n- Compute image isophotes"</span>); std::fflush(stderr);
<a name="l00350"></a>00350   CImgList&lt;unsigned int&gt; isoprimitives;
<a name="l00352"></a>00352   CImgList&lt;unsigned char&gt; isocolors;
<a name="l00353"></a>00353   CImg&lt;&gt; isopoints;
<a name="l00354"></a>00354   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;255; i+=di) {
<a name="l00355"></a>00355     CImgList&lt;&gt; prims;
<a name="l00356"></a>00356     <span class="keyword">const</span> CImg&lt;&gt; pts = norm.get_isoline3d(prims,(<span class="keywordtype">float</span>)i);
<a name="l00357"></a>00357     isopoints.append_object3d(isoprimitives,pts,prims);
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359   cimglist_for(isoprimitives,l) {
<a name="l00360"></a>00360     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i0 = isoprimitives(l,0);
<a name="l00361"></a>00361     <span class="keyword">const</span> <span class="keywordtype">float</span> x0 = isopoints(i0,0), y0 = isopoints(i0,1);
<a name="l00362"></a>00362     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l00363"></a>00363       r = (<span class="keywordtype">unsigned</span> char)image.linear_atXY(x0,y0,0),
<a name="l00364"></a>00364       g = (<span class="keywordtype">unsigned</span> char)image.linear_atXY(x0,y0,1),
<a name="l00365"></a>00365       b = (<span class="keywordtype">unsigned</span> char)image.linear_atXY(x0,y0,2);
<a name="l00366"></a>00366     isocolors.insert(CImg&lt;unsigned char&gt;::vector(r,g,b));
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368   cimg_forX(isopoints,l) isopoints(l,2) = -ratioz*norm.linear_atXY(isopoints(l,0),isopoints(l,1));
<a name="l00370"></a>00370   CImgList&lt;unsigned char&gt; isocolors2;
<a name="l00371"></a>00371   isocolors2=isocolors;
<a name="l00372"></a>00372   cimglist_for(isocolors2,l) isocolors2(l).fill(255);<span class="comment">//white</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="comment">// Save object if necessary</span>
<a name="l00375"></a>00375   <span class="keywordflow">if</span> (file_o)
<a name="l00376"></a>00376   {
<a name="l00377"></a>00377     std::fprintf(stderr,<span class="stringliteral">"\n- Save 3d object as '%s'"</span>,cimg::basename(file_o)); std::fflush(stderr);
<a name="l00378"></a>00378     points.save_off(file_o,primitives,colors);
<a name="l00379"></a>00379   }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="comment">//display GUI information</span>
<a name="l00382"></a>00382   std::fprintf(stderr,
<a name="l00383"></a>00383                <span class="stringliteral">"\n- Enter interactive loop.\n\n"</span>
<a name="l00384"></a>00384                <span class="stringliteral">"GUI reminder: \n"</span>
<a name="l00385"></a>00385                <span class="stringliteral">" + Use mouse to rotate and zoom object\n"</span>
<a name="l00386"></a>00386                <span class="stringliteral">" + key 'F'          : toggle Fullscreen\n"</span>
<a name="l00387"></a>00387                <span class="stringliteral">" + key 'Q' or 'ESC' : Quit (i.e. exit)\n"</span>
<a name="l00388"></a>00388                <span class="stringliteral">" load or save file:\n"</span>
<a name="l00389"></a>00389                <span class="stringliteral">" + key 'S'          : Save displayed image (i.e. 3D view)\n"</span>
<a name="l00390"></a>00390                <span class="stringliteral">" + key 'O'          : save pOse (i.e. 3D view parameters)\n"</span>
<a name="l00391"></a>00391                <span class="stringliteral">" + key 'R'          : Read pose (i.e. 3D view parameters)\n"</span>
<a name="l00392"></a>00392                <span class="stringliteral">" render type:\n"</span>
<a name="l00393"></a>00393                <span class="stringliteral">" + key 'C'          : color render (image or constant)\n"</span>
<a name="l00394"></a>00394                <span class="stringliteral">" + key 'T'          : poinTs render\n"</span>
<a name="l00395"></a>00395                <span class="stringliteral">" + key 'L'          : Lines render\n"</span>
<a name="l00396"></a>00396                <span class="stringliteral">" + key 'A'          : fAces render\n"</span>
<a name="l00397"></a>00397                <span class="stringliteral">" + key 'H'          : flat-sHaded faces render\n"</span>
<a name="l00398"></a>00398                <span class="stringliteral">" + key 'G'          : Gouraud-shaded faces render\n"</span>
<a name="l00399"></a>00399                <span class="stringliteral">" + key 'P'          : Phong-shaded faces render\n"</span>
<a name="l00400"></a>00400                <span class="stringliteral">" + key 'I'          : Isophotes render\n"</span>
<a name="l00401"></a>00401                <span class="stringliteral">" + key 'BackSpace'  : change rendering type (i.e. decrement type)\n"</span>
<a name="l00402"></a>00402                <span class="stringliteral">" + Any other key    : change rendering type (i.e. increment type)\n\n"</span>
<a name="l00403"></a>00403                ); std::fflush(stderr);
<a name="l00404"></a>00404   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> title = <span class="stringliteral">"Image viewed as a surface"</span>;
<a name="l00405"></a>00405   CImgDisplay disp(800,600,title,0);
<a name="l00406"></a>00406   CImg&lt;float&gt; pose=CImg&lt;float&gt;::identity_matrix(4);
<a name="l00407"></a>00407   <span class="comment">//load pose if set</span>
<a name="l00408"></a>00408   <span class="keywordflow">if</span>(file_pose_i) {std::cerr&lt;&lt;<span class="stringliteral">"- read pose from file \""</span>&lt;&lt;file_pose_i&lt;&lt;<span class="stringliteral">"\"\n"</span>&lt;&lt;std::flush;pose.load(file_pose_i);}
<a name="l00409"></a>00409 <span class="comment">//pose.print("pose");std::cerr&lt;&lt;std::flush;</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">//GUI loop</span>
<a name="l00412"></a>00412   <span class="keywordflow">while</span> (!disp.is_closed())
<a name="l00413"></a>00413   {
<a name="l00414"></a>00414     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> text_color[3]={123,234,234};
<a name="l00415"></a>00415     CImg&lt;unsigned char&gt; visu(disp.width(),disp.height(),1,3,0);
<a name="l00416"></a>00416     visu.draw_text(10,10,<span class="stringliteral">"%s"</span>,text_color,0,1,24,
<a name="l00417"></a>00417                 rtype==0?<span class="stringliteral">"Points (0,T)"</span>:(rtype==1?<span class="stringliteral">"Lines (1,L)"</span>:(rtype==2?<span class="stringliteral">"Faces (2,A)"</span>:(rtype==3?<span class="stringliteral">"Flat-shaded faces (3,H)"</span>:
<a name="l00418"></a>00418                (rtype==4?<span class="stringliteral">"Gouraud-shaded faces (4,G)"</span>:(rtype==5?<span class="stringliteral">"Phong-shaded faces (5,P)"</span>:<span class="stringliteral">"Isophotes (6,I)"</span>))))));
<a name="l00419"></a>00419     <span class="keyword">static</span> <span class="keywordtype">bool</span> first_time=(file_pose_i)?<span class="keyword">false</span>:<span class="keyword">true</span>;
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (rtype==6) visu.display_object3d(disp,isopoints,isoprimitives,(color_type)?isocolors:isocolors2,first_time,1,-1,<span class="keyword">true</span>,
<a name="l00421"></a>00421                                         500.0f,0.0f,0.0f,-5000.0f,0.0f,0.0f,<span class="keyword">true</span>,pose.data());
<a name="l00422"></a>00422     <span class="keywordflow">else</span> visu.display_object3d(disp,points,primitives,(color_type)?colors:colors2,first_time,rtype,-1,<span class="keyword">true</span>,
<a name="l00423"></a>00423                                500.0f,0.0f,0.0f,-5000.0f,0.0f,0.0f,<span class="keyword">true</span>,pose.data());
<a name="l00424"></a>00424     first_time=<span class="keyword">false</span>;
<a name="l00425"></a>00425 <span class="comment">//pose.print("pose");std::cerr&lt;&lt;std::flush;</span>
<a name="l00426"></a>00426     <span class="keywordflow">switch</span> (disp.key())
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428     <span class="keywordflow">case</span> 0: <span class="keywordflow">break</span>;
<a name="l00429"></a>00429     <span class="keywordflow">case</span> cimg::keyBACKSPACE: rtype=(7+rtype-1)%7; <span class="keywordflow">break</span>;
<a name="l00430"></a>00430     <span class="keywordflow">case</span> cimg::keyQ:
<a name="l00431"></a>00431     <span class="keywordflow">case</span> cimg::keyESC: disp.close(); <span class="keywordflow">break</span>;
<a name="l00432"></a>00432     <span class="comment">//fullscreen display or not</span>
<a name="l00433"></a>00433     <span class="keywordflow">case</span> cimg::keyF:
<a name="l00434"></a>00434       <span class="keywordflow">if</span> (disp.is_fullscreen()) disp.resize(800,600); <span class="keywordflow">else</span> disp.resize(disp.screen_width(),disp.screen_height());
<a name="l00435"></a>00435       disp.toggle_fullscreen();
<a name="l00436"></a>00436       <span class="keywordflow">break</span>;
<a name="l00437"></a>00437     <span class="comment">//save display</span>
<a name="l00438"></a>00438     <span class="keywordflow">case</span> cimg::keyS: {std::string file_tmp=<span class="stringliteral">"CImg_surface3D.png"</span>;std::cerr&lt;&lt;<span class="stringliteral">"saving display as image in \""</span>&lt;&lt;file_tmp&lt;&lt;<span class="stringliteral">"\".\n"</span>&lt;&lt;std::flush;CImg&lt;unsigned char&gt; tmp;disp.snapshot(tmp);tmp.save(file_tmp.c_str());} <span class="keywordflow">break</span>;
<a name="l00439"></a>00439     <span class="comment">//save pose</span>
<a name="l00440"></a>00440     <span class="keywordflow">case</span> cimg::keyO: {std::cerr&lt;&lt;<span class="stringliteral">"saving pose in file \""</span>&lt;&lt;file_pose_o&lt;&lt;<span class="stringliteral">"\".\n"</span>&lt;&lt;std::flush;pose.save(file_pose_o);}<span class="keywordflow">break</span>;
<a name="l00441"></a>00441     <span class="comment">//load pose</span>
<a name="l00442"></a>00442     <span class="keywordflow">case</span> cimg::keyR: {std::cerr&lt;&lt;<span class="stringliteral">"loading pose from file \""</span>&lt;&lt;file_pose_i&lt;&lt;<span class="stringliteral">"\".\n"</span>&lt;&lt;std::flush;pose.load(file_pose_i);}<span class="keywordflow">break</span>;
<a name="l00443"></a>00443     <span class="comment">//display type</span>
<a name="l00444"></a>00444     <span class="keywordflow">case</span> cimg::keyC: color_type=(color_type)?<span class="keyword">false</span>:<span class="keyword">true</span>;<span class="keywordflow">break</span>;<span class="comment">//color type</span>
<a name="l00445"></a>00445     <span class="keywordflow">case</span> cimg::keyT: rtype=0;<span class="keywordflow">break</span>;<span class="comment">//poinTs</span>
<a name="l00446"></a>00446     <span class="keywordflow">case</span> cimg::keyL: rtype=1;<span class="keywordflow">break</span>;<span class="comment">//Lines</span>
<a name="l00447"></a>00447     <span class="keywordflow">case</span> cimg::keyA: rtype=2;<span class="keywordflow">break</span>;<span class="comment">//fAces</span>
<a name="l00448"></a>00448     <span class="keywordflow">case</span> cimg::keyH: rtype=3;<span class="keywordflow">break</span>;<span class="comment">//flat-sHaded faces</span>
<a name="l00449"></a>00449     <span class="keywordflow">case</span> cimg::keyG: rtype=4;<span class="keywordflow">break</span>;<span class="comment">//Gouraud-shaded faces</span>
<a name="l00450"></a>00450     <span class="keywordflow">case</span> cimg::keyP: rtype=5;<span class="keywordflow">break</span>;<span class="comment">//Phong-shaded faces</span>
<a name="l00451"></a>00451     <span class="keywordflow">case</span> cimg::keyI: rtype=6;<span class="keywordflow">break</span>;<span class="comment">//Isophotes</span>
<a name="l00452"></a>00452     <span class="keywordflow">default</span>: rtype = (rtype+1)%7; <span class="keywordflow">break</span>;
<a name="l00453"></a>00453     }<span class="comment">//Key switch</span>
<a name="l00454"></a>00454   }<span class="comment">//GUI loop</span>
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 <span class="comment">// Main procedure</span>
<a name="l00457"></a><a class="code" href="CImg_8display_8cpp.html#3c04138a5bfe5d72780bb7e82a18e627">00457</a> <span class="keywordtype">int</span> <a class="code" href="CImg_8display_8cpp.html#3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv)
<a name="l00458"></a>00458 {
<a name="l00460"></a>00460 <span class="comment">// Define program usage and read command line parameters</span>
<a name="l00461"></a>00461   <span class="comment">// Display program usage, when invoked from the command line with option '-h'.</span>
<a name="l00462"></a>00462   cimg_usage(<span class="stringliteral">"display image as 2D map or/and 1D graph(s) or 3D surface."</span>);
<a name="l00463"></a>00463   <span class="comment">// Read image filename from the command line (or set it to "img/parrot_original.ppm" if option '-i' is not provided).</span>
<a name="l00464"></a>00464   <span class="keyword">const</span> <span class="keywordtype">char</span>* file_i = cimg_option(<span class="stringliteral">"-i"</span>,<span class="stringliteral">"image.png"</span>,<span class="stringliteral">"Input image"</span>);
<a name="l00465"></a>00465   <span class="comment">//pre-processing options</span>
<a name="l00467"></a>00467 <span class="comment"></span>  <span class="keyword">const</span> <span class="keywordtype">double</span> sigma = cimg_option(<span class="stringliteral">"--blur"</span>,-1.0,<span class="stringliteral">"Variance of gaussian pre-blurring (e.g. --blur 2.0)"</span>);
<a name="l00468"></a>00468   <span class="keyword">const</span> <span class="keywordtype">bool</span> normalize=cimg_option(<span class="stringliteral">"--norm"</span>,<span class="keyword">false</span>,<span class="stringliteral">"normalize image between 0 and 255 for 8-bit display (e.g. --norm true)"</span>);
<a name="l00469"></a>00469   <span class="comment">//1D display options</span>
<a name="l00470"></a>00470   <span class="keyword">const</span> <span class="keywordtype">bool</span> display_1D=cimg_option(<span class="stringliteral">"--1D"</span>,<span class="keyword">false</span>,<span class="stringliteral">"display also profile (i.e. 1D graph with --1D true)"</span>);
<a name="l00471"></a>00471   <span class="comment">//3D display options</span>
<a name="l00472"></a>00472   <span class="keyword">const</span> <span class="keywordtype">bool</span> display_3D=cimg_option(<span class="stringliteral">"--3D"</span>,<span class="keyword">false</span>,<span class="stringliteral">"display as 3D surface"</span>);
<a name="l00473"></a>00473   <span class="keyword">const</span> <span class="keywordtype">char</span> *file_o    = cimg_option(<span class="stringliteral">"-o"</span>,(<span class="keywordtype">char</span>*)0,<span class="stringliteral">"Output 3D object"</span>);
<a name="l00474"></a>00474   <span class="keyword">const</span> <span class="keywordtype">float</span> ratioz    = cimg_option(<span class="stringliteral">"-z"</span>,0.25f,<span class="stringliteral">"Aspect ratio along z-axis"</span>);
<a name="l00475"></a>00475   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> di = cimg_option(<span class="stringliteral">"-di"</span>,10,<span class="stringliteral">"Step for isophote skipping"</span>);
<a name="l00476"></a>00476   <span class="keyword">const</span> <span class="keywordtype">char</span> *file_pose_i    = cimg_option(<span class="stringliteral">"-pi"</span>,(<span class="keywordtype">char</span>*)0,<span class="stringliteral">"Input 3D pose  (e.g. pose.cimg)"</span>);
<a name="l00477"></a>00477   <span class="keyword">const</span> <span class="keywordtype">char</span> *file_pose_o    = cimg_option(<span class="stringliteral">"-po"</span>,<span class="stringliteral">"pose.cimg"</span>,<span class="stringliteral">"Output 3D pose (e.g. pose.cimg)"</span>);
<a name="l00478"></a>00478   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtype=cimg_option(<span class="stringliteral">"--render-type"</span>,2,<span class="stringliteral">"type of rendering (E[0-6], see GUI: render type)"</span>);
<a name="l00479"></a>00479   <span class="keywordtype">bool</span> color_type=cimg_option(<span class="stringliteral">"--color-type"</span>,<span class="keyword">true</span>,<span class="stringliteral">"type of surface color: true image color, false constant color"</span>);
<a name="l00480"></a>00480   <span class="comment">//help</span>
<a name="l00481"></a>00481   <span class="keyword">const</span> <span class="keywordtype">bool</span> help=cimg_option(<span class="stringliteral">"-h"</span>,<span class="keyword">false</span>,<span class="stringliteral">"display this help."</span>);
<a name="l00482"></a>00482   <span class="comment">//exit on help request '-h' command line option</span>
<a name="l00483"></a>00483   <span class="keywordflow">if</span>(help) <span class="keywordflow">return</span> 0;
<a name="l00484"></a>00484   <span class="comment">// Load an image, transform it to a color image (if necessary) and blur it with the standard deviation sigma.</span>
<a name="l00485"></a>00485   CImg&lt;&gt; image(file_i);
<a name="l00487"></a>00487   <span class="keywordflow">if</span>(normalize) image.normalize(0,255);
<a name="l00488"></a>00488   <span class="keywordflow">if</span>(sigma&gt;0.0) image.blur((<span class="keywordtype">float</span>)sigma);
<a name="l00489"></a>00489   <span class="comment">//display</span>
<a name="l00490"></a>00490   <span class="keywordflow">if</span>(display_1D)
<a name="l00492"></a>00492   {
<a name="l00493"></a>00493     <a class="code" href="CImg_8display_8cpp.html#1ddf6ad29b94342df84bf770d6d90b11" title="display image as both 2D map and 1D graphs along x or y axis">display1D2D</a>(image);
<a name="l00494"></a>00494   }<span class="comment">//display_1D</span>
<a name="l00495"></a>00495   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(display_3D)
<a name="l00497"></a>00497   {
<a name="l00498"></a>00498     <a class="code" href="CImg_8display_8cpp.html#b599c0258589192cac899b35ef432ce0" title="display image as 3D surface">display3D</a>(image,file_o,ratioz,di,file_pose_i,file_pose_o,rtype,color_type);
<a name="l00499"></a>00499   }<span class="comment">//display_3D</span>
<a name="l00500"></a>00500   <span class="keywordflow">else</span>
<a name="l00502"></a>00502   {
<a name="l00503"></a>00503     image.display(file_i);
<a name="l00504"></a>00504   }<span class="comment">//display_2D</span>
<a name="l00505"></a>00505   <span class="keywordflow">return</span> 0;
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Dec 2 23:36:50 2010 for CImg.display by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
